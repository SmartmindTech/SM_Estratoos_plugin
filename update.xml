<?xml version="1.0" encoding="UTF-8"?>
<!--
    Moodle plugin update server configuration file.

    This file is checked by Moodle to determine if updates are available.
    When you release a new version:
    1. Update the version number in version.php
    2. Update this file with the new version details
    3. Create a GitHub release with the ZIP file
    4. Commit and push both files

    GitHub Repository: https://github.com/SmartmindTech/SM_Estratoos_plugin
-->
<updates>
    <update>
        <!-- Plugin identifier (must match $plugin->component in version.php) -->
        <component>local_sm_estratoos_plugin</component>

        <!-- Version number (must match $plugin->version in version.php) -->
        <version>2025011917</version>

        <!-- Human-readable release version -->
        <release>1.7.17</release>

        <!-- Minimum required Moodle version -->
        <requires>2022112800</requires>

        <!-- Maturity level: MATURITY_ALPHA=50, MATURITY_BETA=100, MATURITY_RC=150, MATURITY_STABLE=200 -->
        <maturity>200</maturity>

        <!-- URL to download the plugin ZIP file (use GitHub releases) -->
        <download>https://github.com/SmartmindTech/SM_Estratoos_plugin/releases/download/v1.7.17/sm_estratoos_plugin.zip</download>

        <!-- Optional: URL for more information about this update -->
        <url>https://github.com/SmartmindTech/SM_Estratoos_plugin/releases/tag/v1.7.17</url>

        <!-- Release notes (keep it brief) -->
        <releasenotes>
            <![CDATA[
            <h3>Version 1.7.17 - Fix Company Search Bar (Inline JS)</h3>
            <p><strong>Switch from AMD module to inline JavaScript for reliable search functionality</strong></p>

            <h4>Root Cause Analysis:</h4>
            <p>In v1.7.1, search worked because there was no companyaccess.min.js file - Moodle loaded
            the source JS directly. Later versions added the minified file, which caused caching issues
            in production mode where Moodle would load outdated cached versions.</p>

            <h4>Solution:</h4>
            <ul>
                <li><strong>Inline JavaScript:</strong> Removed AMD module dependency, embedded JS directly in PHP</li>
                <li><strong>No caching issues:</strong> Inline JS runs fresh on every page load</li>
                <li><strong>Same functionality:</strong> Search, Select All, Deselect All, badge toggling</li>
                <li><strong>Enabled/Disabled badges:</strong> Green badge for enabled, gray for disabled</li>
            </ul>

            <h4>Why This Works:</h4>
            <p>AMD modules in Moodle are cached aggressively. In production mode, the .min.js file is loaded
            and cached. Even after plugin updates, old cached versions may persist. Inline JavaScript
            bypasses this entirely - it's rendered fresh with each PHP page load.</p>
            ]]>
        </releasenotes>
    </update>
</updates>
